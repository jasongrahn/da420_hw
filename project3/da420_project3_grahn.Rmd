---
title: "DA420_project3_Grahn"
author: "Jason Grahn"
date: "1/25/2019"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
```

#Part 1
This will be attached separately. 

#Part 2

Consider Exhibit 4.1 in page 50-51. Suppose your client is someone other than the local farmer, a meat producer/butcher, dairy, or brewer perhaps. Determine association rules relevant to your clientâ€™s products guided by the market basket model. What recommendations would you make about future marketplace actions?

## Analysis
We selected running the market basket analysis for a brewer, and opted to find rules related to "beer". 

The results included 6 rules, the strongest of which was for non-alcoholic beer. That is to say, when a consumner purchases non-alcoholic beer, they will also purchase beer. The second highest rule is simply beer by itself. The remaining rules in order are bread and baked goods, vegetables, fruit, and dairy produce.

Given these rules, it makes sense that the brewer investigate producing a non-alcoholic beer of their own if they haven't already. Given the high association of non-alcoholic beer with beer, consumer confidence in a non-alcoholic beer could lead to purchases of the same companies' alcoholic beer as well, as "birds of a feather." The remaining rules indicate purchases of items used for cookouts (bread/baked goods, veggies, fruit, and dairy produce). Dairy produce in this case could be cheeses, while bread and baked goods could related to hotdog and hamburger buns. 

Additionally, it makes market-sense for the brewer to align their product with a "friendly" supplier of breads and dairy. Perhaps they might offer coupons or discounts to select grocery stores; when customers purchase a these associated products, they receive a discount on beer. As an alternative, purchasing beer of their brand could enable discounts on select breads and baked products.

Given the relationship of beer to these items, we must also inquire toward the seasonality of the data-set. This merits additional study to determine if decisions made now might only be good for a small window of time during the year. 

```{r}
# Association Rules for Market Basket Analysis (R)

library(arules)  # association rules
library(arulesViz)  # data visualization of association rules
library(RColorBrewer)  # color palettes for plots

data(Groceries)  # grocery transactions object from arules package

# examine frequency for each item with support greater than 0.025
itemFrequencyPlot(Groceries, support = 0.025, cex.names=0.8, xlim = c(0,0.3),
                  type = "relative", horiz = TRUE, col = "light blue", las = 1,
                  xlab = paste("Proportion of Market Baskets Containing Item",
                               "\n(Item Relative Frequency or Support)"))
```

```{r}
# explore possibilities for combining similar items
print(head(itemInfo(Groceries))) 
print(levels(itemInfo(Groceries)[["level1"]]))  # 10 levels... too few 
print(levels(itemInfo(Groceries)[["level2"]]))  # 55 distinct levels
```

```{r}
# aggregate items using the 55 level2 levels for food categories
# to create a more meaningful set of items
groceries <- aggregate(Groceries, itemInfo(Groceries)[["level2"]])  

#print(dim(groceries)[1])  # 9835 market baskets for shopping trips
#print(dim(groceries)[2])  # 55 final store items (categories)  
itemFrequencyPlot(groceries, support = 0.025, cex.names=1.0, xlim = c(0,0.5),
                  type = "relative", horiz = TRUE, col = "dark blue", las = 1,
                  xlab = paste("Proportion of Market Baskets Containing Item",
                               "\n(Item Relative Frequency or Support)"))
```


```{r message=FALSE}
# obtain large set of association rules for items by category and all shoppers
# this is done by setting very low criteria for support and confidence
first.rules <- apriori(groceries, parameter = list(support = 0.001, confidence = 0.05))

# select association rules using thresholds for support and confidence 
second.rules <- apriori(groceries, parameter = list(support = 0.025, confidence = 0.05))

# data visualization of association rules in scatter plot
plot(second.rules, 
     control=list(jitter=2, 
                  col = rev(brewer.pal(9, "Greens")[4:9])),
     shading = "lift")
```

```{r}
# grouped matrix of rules is too clustered to show anything
plot(second.rules, method="grouped",   
  control=list(col = rev(brewer.pal(9, "Greens")[4:9])))
```

```{r}
# select rules with vegetables in consequent (right-hand-side) item subsets
beer.rules <- subset(second.rules, subset = rhs %pin% "beer")
inspect(beer.rules)  # 6 rules
```


```{r}
# sort by lift and identify the top 10 rules
top.beer.rules <- head(sort(beer.rules, decreasing = TRUE, by = "lift"), 10)
inspect(top.beer.rules) 
```

Or visually:
```{r}
plot(top.beer.rules, method="grouped",   
  control=list(col = rev(brewer.pal(9, "Greens")[4:9])))
```

```{r}
plot(top.beer.rules, method="graph", 
  control=list(type="items"), 
  shading = "lift")
```



