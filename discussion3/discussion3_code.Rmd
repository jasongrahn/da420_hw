---
title: "code_for_discussion3"
author: "Jason Grahn"
date: "1/21/2019"
output: github_document
---

The instructor has us blindly running the code from https://blog.revolutionanalytics.com/2015/04/association-rules-and-market-basket-analysis-with-r.html witout any sort of explanation. 

So, I'm running it. But this is a better resource: http://www.rdatamining.com/examples/association-rules

going to try running it on mtcars, 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

##Have to load `MTcars` and make get the factor columns
```{r}
#load out mtcars and make factors
mt.mute <- mtcars %>% 
  mutate(high_mpg = if_else(mpg >= 25, TRUE, FALSE)) %>% 
  arrange(desc(high_mpg)) %>% 
  select(cyl,vs:high_mpg) %>% 
  mutate(cyl = as.factor(cyl),
         vs = as.factor(vs),
         am = as.factor(am),
         gear = as.factor(gear),
         carb = as.factor(carb),
         high_mpg = as.factor(high_mpg))

#and let's just pare down the dataset so we dont get SO MANY rules? 
mt.mute <- head(mt.mute,15)
idx <- sample(1:nrow(mt.mute), 5)

mt.mute[idx, ]
summary(mt.mute)
```

##Here's where we load `arules` to find those association rules

```{r}
 library(arules)
 # find association rules with default settings
rules <- apriori(mt.mute)
#head(inspect(rules),15)
```

##and now we want to make some rules for high_mpg = TRUE
```{r}
# rules with rhs containing "high_mpg" only
rules <- apriori(mt.mute,
                 parameter = list(minlen=2, supp=0.005, conf=0.8),
                 appearance = list(rhs=c("high_mpg=TRUE", 
                                         "high_mpg=FALSE"),
                                   default="lhs"),
                 control = list(verbose=F))
rules.sorted <- sort(rules, by="lift")
```

```{r include=FALSE}
#inspect(rules.sorted)
#gives us 149 rules. egads. 
#Since we can't head() this, let's just not output it. 
#(inspect(rules.sorted)
```

So we find redundant rules if it's possible! 

```{r}
# find redundant rules
subset.matrix <- is.subset(rules.sorted, rules.sorted)
subset.matrix[lower.tri(subset.matrix, diag=T)] <- NA
redundant <- colSums(subset.matrix, na.rm=T) >= 1
```
 
Ok, so which rules are redundant?
```{r}
#putting a head on this because it's rather long
head(which(redundant),10)
```

```{r message=FALSE, warning=FALSE, paged.print=FALSE}
#Now let's remove redundant rules
rules.pruned <- rules.sorted[!redundant]

#this can't be head()'d, so no output please. 
inspect(rules.pruned)
```

interpretation
```{r}
library(arulesViz)
plot(rules)
```

```{r}
plot(rules, method="graph", control=list(type="items"))
```

```{r}
plot(rules, method="paracoord", control=list(reorder=TRUE))
```

